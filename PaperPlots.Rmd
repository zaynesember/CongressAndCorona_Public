---
title: "Paper Plots"
author: "Zayne Sember"
date: "4/1/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gridExtra)
library(ggpubr)
library(cowplot)
library(facetscales)
```

# 5 Data and Methodology

## 5.2 Distribution of Offical Account Tweets

Tweet time series Jan 2019-Nov 2020
```{r}
# Lump Sanders in with Dems
# data.text.official.prepandemic.all$party.code[data.text.official.prepandemic.all$name=="Bernie Sanders"] <- 100
# 
# data.text.official.covid.all$party.code[data.text.official.covid.all$name=="Bernie Sanders"] <- 100


weeks_all <- data.frame(date = seq.Date(min(data.text.official.prepandemic.all$date) + 1, 
                                        min(data.text.official.covid.all$date) - 1, 
                                        by="day"), 
                                week = sort(rep(c(-51:0),7))) 

weeks_all <- weeks_all %>% 
  mutate(week.start=sort(rep(weeks_all$date[seq(1, length(weeks_all$date), 7)],7))) %>% 
  mutate(week.end=week.start + 7)

week.index.lookup.all <- rbind(weeks_all, week.index.lookup)
rm(weeks_all)


agg.daily.tweet.count.jan2019.nov2020 <- data.text.official.prepandemic.all %>%
  group_by(date, name) %>%
  summarize(tweet.count=n(), across()) %>%
  select(date, name, tweet.count, party.code, chamber) %>% 
  distinct() %>%
  group_by(date) %>% 
  summarize("All"=sum(tweet.count),
            "House"=sum(tweet.count[chamber=="House"]),
            "House Democrats"=sum(tweet.count[chamber=="House" & party.code==100]),
            "House Republicans"=sum(tweet.count[chamber=="House" & party.code==200]),
            "Senate"=sum(tweet.count[chamber=="Senate"]),
            "Senate Democrats"=sum(tweet.count[chamber=="Senate" & party.code==100]),
            "Senate Republicans"=sum(tweet.count[chamber=="Senate" & party.code==200])) %>% 
  pivot_longer(!date, names_to="label", values_to="tweet.count")

temp <- data.text.official.covid.all %>%
  group_by(date, name) %>%
  summarize(tweet.count=n(), across()) %>%
  select(date, name, tweet.count, party.code, chamber) %>% 
  distinct() %>%
  group_by(date) %>% 
  summarize("All"=sum(tweet.count),
            "House"=sum(tweet.count[chamber=="House"]),
            "House Democrats"=sum(tweet.count[chamber=="House" & party.code==100]),
            "House Republicans"=sum(tweet.count[chamber=="House" & party.code==200]),
            "Senate"=sum(tweet.count[chamber=="Senate"]),
            "Senate Democrats"=sum(tweet.count[chamber=="Senate" & party.code==100]),
            "Senate Republicans"=sum(tweet.count[chamber=="Senate" & party.code==200])) %>% 
  pivot_longer(!date, names_to="label", values_to="tweet.count")


agg.daily.tweet.count.jan2019.nov2020 <- rbind(agg.daily.tweet.count.jan2019.nov2020, temp) %>%
  arrange(date) %>% 
  mutate(tweet.count.per.capita = case_when(
    label=="All" ~ tweet.count/530, # 5 vacancies as over Nov. 3 2020
    label=="House" ~ tweet.count/430,
    label=="Senate" ~ tweet.count/100,
    label=="House Democrats" ~ tweet.count/232,
    label=="House Republicans" ~ tweet.count/197,
    label=="Senate Democrats" ~ tweet.count/47,
    label=="Senate Republicans" ~ tweet.count/53)) 
# For more exact calc, could condition on date to account for vacancies arising

agg.weekly.tweet.count.jan2019.nov2020 <- 
  agg.daily.tweet.count.jan2019.nov2020 %>% 
  left_join(week.index.lookup.all, by="date") %>% 
  group_by(week, label) %>% 
  summarize(tweet.count=sum(tweet.count),
            tweet.count.per.capita=sum(tweet.count.per.capita), across()) %>% 
  select(-date) %>% 
  distinct() %>% drop_na()

rm(temp)


agg.monthly.tweet.count.jan2019.nov2020 <- agg.daily.tweet.count.jan2019.nov2020 %>% 
  mutate(month=format(date,"%Y-%m")) %>% 
  group_by(month, label) %>% 
  summarize(tweet.count=sum(tweet.count)) %>% 
  mutate(tweet.count.per.capita = case_when(
    label=="All" ~ tweet.count/530, # 5 vacancies as over Nov. 3 2020
    label=="House" ~ tweet.count/430,
    label=="Senate" ~ tweet.count/100,
    label=="House Democrats" ~ tweet.count/232,
    label=="House Republicans" ~ tweet.count/197,
    label=="Senate Democrats" ~ tweet.count/47,
    label=="Senate Republicans" ~ tweet.count/53))

```
Count Time Series
```{r}
temp_top <- agg.weekly.tweet.count.jan2019.nov2020 %>% 
  filter(label %in% c("All", "House", "Senate")) %>% 
  mutate(plot_label = "top")

temp_middle <- agg.weekly.tweet.count.jan2019.nov2020 %>% 
  filter(label %in% c("House Democrats", "House Republicans")) %>% 
  mutate(plot_label = "middle")

temp_bottom <- agg.weekly.tweet.count.jan2019.nov2020 %>% 
  filter(label %in% c("Senate Democrats", "Senate Republicans")) %>% 
  mutate(plot_label = "bottom")

temp_forplot <- rbind(temp_top, temp_middle, temp_bottom) %>% drop_na()

rm(temp_top, temp_middle, temp_bottom)

ggplot(data=temp_forplot, aes(x=week.start, y=tweet.count, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  geom_vline(xintercept=as.Date("2020-01-20"), linetype="dashed", size=0.75, alpha=0.5) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               " "=1,
                                               "Senate"=15,                                             
                                               "House"=17,
                                               "Senate Democrats"=15,
                                               "House Democrats"=17,
                                               "Senate Republicans"=15,
                                               "House Republicans"=17
                                               ),
                     labels=c("All",
                              " ",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               " "="white",
                                               "Senate"="purple4",
                                               "House"="orange3",
                                               "Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c("All",
                              " ",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweet count", title="") +
  facet_wrap(~factor(plot_label, levels=c("top", "middle", "bottom")), nrow=3, scales="free_y") +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=70, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.08),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=9),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    plot.margin=unit(c(0.75,0.1,0,0), "cm")) +
    guides(color=guide_legend(nrow=2, byrow=F),
           shape=guide_legend(nrow=2, byrow=F)
  )
```
Tweets Per Member Time Series
```{r}
ggplot(data=temp_forplot, aes(x=week.start, y=tweet.count.per.capita, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  geom_vline(xintercept=as.Date("2020-01-20"), linetype="dashed", size=0.75, alpha=0.5) +
  ylim(c(0,35)) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               " "=1,
                                               "Senate"=15,                                             
                                               "House"=17,
                                               "Senate Democrats"=15,
                                               "House Democrats"=17,
                                               "Senate Republicans"=15,
                                               "House Republicans"=17
                                               ),
                     labels=c("All",
                              " ",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               " "="white",
                                               "Senate"="purple4",
                                               "House"="orange3",
                                               "Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c("All",
                              " ",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(plot_label, levels=c("top", "middle", "bottom")), nrow=3, scales="free_y") +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=70, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position="none",#c(.45,1.08),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=9),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    plot.margin=unit(c(0,0.1,0,0), "cm")) +
    guides(color=guide_legend(nrow=2, byrow=F),
           shape=guide_legend(nrow=2, byrow=F)
  )
```
Party and Chamber difference in tweets per member
```{r}
agg.daily.party.diff.jan2019.nov2020 <- agg.daily.tweet.count.jan2019.nov2020 %>% 
  filter(label %in% c("House Democrats", "House Republicans")) %>% 
  arrange(date) %>% 
  group_by(date) %>% 
  summarize(across(c(tweet.count, tweet.count.per.capita), diff, .names='diff.{col}')) %>% 
  mutate(diff.tweet.count=-1*diff.tweet.count, 
         diff.tweet.count.per.capita=-1*diff.tweet.count.per.capita,
         label="House Democrats - Republicans") %>% 
  rbind(
    agg.daily.tweet.count.jan2019.nov2020 %>% 
      filter(label %in% c("Senate Democrats", "Senate Republicans")) %>% 
      arrange(date) %>% 
      group_by(date) %>% 
      summarize(across(c(tweet.count, tweet.count.per.capita), diff, .names='diff.{col}')) %>% 
      mutate(diff.tweet.count=-1*diff.tweet.count, 
             diff.tweet.count.per.capita=-1*diff.tweet.count.per.capita,
             label="Senate Democrats - Republicans") )


agg.weekly.party.diff.jan2019.nov2020 <- agg.weekly.tweet.count.jan2019.nov2020 %>% 
  filter(label %in% c("House Democrats", "House Republicans")) %>% 
  arrange(week.start) %>% 
  group_by(week.start) %>% 
  summarize(across(c(tweet.count, tweet.count.per.capita), diff, .names='diff.{col}')) %>% 
  mutate(diff.tweet.count=-1*diff.tweet.count, 
         diff.tweet.count.per.capita=-1*diff.tweet.count.per.capita,
         label="House Democrats - Republicans") %>% 
  rbind(
    agg.weekly.tweet.count.jan2019.nov2020 %>% 
      filter(label %in% c("Senate Democrats", "Senate Republicans")) %>% 
      arrange(week.start) %>% 
      group_by(week.start) %>% 
      summarize(across(c(tweet.count, tweet.count.per.capita), diff, .names='diff.{col}')) %>% 
      mutate(diff.tweet.count=-1*diff.tweet.count, 
             diff.tweet.count.per.capita=-1*diff.tweet.count.per.capita,
             label="Senate Democrats - Republicans"))

agg.monthly.party.diff.jan2019.nov2020 <- agg.monthly.tweet.count.jan2019.nov2020 %>% 
  filter(label %in% c("House Democrats", "House Republicans")) %>% 
  arrange(month) %>% 
  group_by(month) %>% 
  summarize(across(c(tweet.count, tweet.count.per.capita), diff, .names='diff.{col}')) %>% 
  mutate(diff.tweet.count=-1*diff.tweet.count, 
         diff.tweet.count.per.capita=-1*diff.tweet.count.per.capita,
         label="House Democrats - Republicans") %>% 
  rbind(
    agg.monthly.tweet.count.jan2019.nov2020 %>% 
      filter(label %in% c("Senate Democrats", "Senate Republicans")) %>% 
      arrange(month) %>% 
      group_by(month) %>% 
      summarize(across(c(tweet.count, tweet.count.per.capita), diff, .names='diff.{col}')) %>% 
      mutate(diff.tweet.count=-1*diff.tweet.count, 
             diff.tweet.count.per.capita=-1*diff.tweet.count.per.capita,
             label="Senate Democrats - Republicans"))

```
```{r}
ggplot(data=agg.weekly.party.diff.jan2019.nov2020, aes(x=week.start, y=diff.tweet.count, 
                              color=factor(label), shape=factor(label))) +
  geom_line(size=0.56, alpha=0.75) +
  geom_point(size=1) +
  geom_vline(xintercept=as.Date("2020-01-20"), linetype="dashed", size=0.75, alpha=0.5) +
  geom_hline(yintercept=0, size=0.57, alpha=1, color="red", linetype="dotdash") +
  ylim(c(-600,2600)) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c("House Democrats - Republicans"=17,
                                               "Senate Democrats - Republicans"=15),
                     labels=c("House Democrats - Republicans",
                              "Senate Democrats - Republicans")) +
  scale_color_manual(name="legend", values = c("House Democrats - Republicans"="orange3",
                                                "Senate Democrats - Republicans"="purple4"),
                     labels=c("House Democrats - Republicans",
                              "Senate Democrats - Republicans"),drop=F) +
  labs(x="", y="Difference in tweet count", title="") +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=70, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.19,.93),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="vertical",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    plot.margin=unit(c(0,0.1,0,0), "cm")) +
    guides(color=guide_legend(nrow=2, byrow=F))

ggplot(data=agg.weekly.party.diff.jan2019.nov2020, aes(x=week.start, y=diff.tweet.count.per.capita, 
                              color=factor(label), shape=factor(label))) +
  geom_line(size=0.56, alpha=0.75) +
  geom_point(size=1.1) +
  geom_vline(xintercept=as.Date("2020-01-20"), linetype="dashed", size=0.75, alpha=0.5) +
  geom_hline(yintercept=0, size=0.57, alpha=1, color="red", linetype="dotdash") +
  ylim(c(-7,15)) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c("House Democrats - Republicans"=17,
                                               "Senate Democrats - Republicans"=15),
                     labels=c("House Democrats - Republicans",
                              "Senate Democrats - Republicans")) +
  scale_color_manual(name="legend", values = c("House Democrats - Republicans"="orange3",
                                                "Senate Democrats - Republicans"="purple4"),
                     labels=c("House Democrats - Republicans",
                              "Senate Democrats - Republicans"),drop=F) +
  labs(x="", y="Difference in tweets per member", title="") +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=70, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.19,.93),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="vertical",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    strip.background = element_blank(),
    strip.text.x = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    plot.margin=unit(c(0,0.1,0,0), "cm")) +
    guides(color=guide_legend(nrow=2, byrow=F))
  
```
Tweet count distribution pre vs. during pandemic
```{r}
ind.hist.data <- data.text.official.covid.all %>% 
  group_by(date, name) %>% 
  summarize(daily.tweet.count=n(), across()) %>% 
  group_by(name) %>% 
  summarize(tweet.count=sum(daily.tweet.count), 
            tweet.count.variance=var(daily.tweet.count),
            tweet.count.mean=mean(daily.tweet.count),
            tweet.count.median=median(daily.tweet.count),
            party.code, chamber) %>% distinct() %>% 
  mutate(label="Pandemic", 
         party=recode(party.code,`100`="Democrats", `200`="Republicans", `328`="Other")) %>% 
  select(-party.code) %>% 
  rbind(
    data.text.official.prepandemic.all %>%
      filter(date >= as.Date("2019-01-20") & date <= as.Date("2019-11-28")) %>% 
      group_by(date, name) %>% 
      summarize(daily.tweet.count=n(), across()) %>% 
      group_by(name) %>% 
      summarize(tweet.count=sum(daily.tweet.count), 
                tweet.count.variance=var(daily.tweet.count),
                tweet.count.mean=mean(daily.tweet.count),
                tweet.count.median=median(daily.tweet.count),
                party.code, chamber) %>% distinct() %>% 
      mutate(label="Prepandemic", 
             party=recode(party.code,`100`="Democrats", `200`="Republicans", `328`="Other")) %>% 
      select(-party.code)
  ) %>% mutate(chamberparty=paste(chamber, party))


ggplot(data=ind.hist.data %>% filter(party!="Other"), 
       aes(x=log(tweet.count), fill=factor(label))) +
  geom_density(alpha=0.5) +
  scale_fill_manual(values=c("Pandemic"="plum4", "Prepandemic"="chartreuse3"),
                    labels=c("Pandemic"="Pandemic (Jan-Nov 2020)  ",
                             "Prepandemic"="Prepandemic (Jan-Nov 2019)")) +
  labs(x="log(total tweet count)", y="Density") +
  facet_wrap(~factor(chamberparty)) +
  theme_light() +
  theme(
    legend.title = element_blank(),
    legend.direction = "horizontal",
    legend.position=c(.5, 1.1),
    legend.text = element_text(size=8),
    legend.background = element_blank(),
    legend.key.size = unit(0.45, "cm"),
    plot.margin=unit(c(1,0.1,0,0), "cm"),
    strip.background = element_blank(),
    strip.text = element_text(color="black"),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    panel.grid.major.x = element_blank(),
    axis.title.y = element_text(size=10)
  )

# ggplot(data=ind.hist.data %>% filter(party!="Other"), 
#        aes(x=log(tweet.count.variance), fill=factor(label))) +
#   geom_density(alpha=0.5) +
#   scale_fill_manual(values=c("Pandemic"="plum4", "Prepandemic"="chartreuse3"),
#                     labels=c("Pandemic"="Pandemic (Jan-Nov 2020)  ",
#                              "Prepandemic"="Prepandemic (Jan-Nov 2019)")) +
#   labs(x="Mean member tweet count", y="Density") +
#   facet_wrap(~factor(chamberparty)) +
#   theme_light() +
#   theme(
#     legend.title = element_blank(),
#     legend.direction = "horizontal",
#     legend.position=c(.5, 1.1),
#     legend.text = element_text(size=8),
#     legend.background = element_blank(),
#     legend.key.size = unit(0.45, "cm"),
#     plot.margin=unit(c(1,0.1,0,0), "cm"),
#     strip.background = element_blank(),
#     strip.text = element_text(color="black"),
#     panel.grid.minor.x = element_blank(),
#     panel.grid.minor.y = element_blank(),
#     panel.grid.major.y = element_blank(),
#     panel.grid.major.x = element_blank(),
#     axis.title.y = element_text(size=10)
#   )
  
```
```{r}
print("HOUSE DEMOCRATS")
t.test(filter(ind.hist.data, chamberparty=="House Democrats", label=="Prepandemic")$tweet.count, filter(ind.hist.data, chamberparty=="House Democrats", label=="Pandemic")$tweet.count)

print("Senate DEMOCRATS")
t.test(filter(ind.hist.data, chamberparty=="Senate Democrats", label=="Prepandemic")$tweet.count, filter(ind.hist.data, chamberparty=="Senate Democrats", label=="Pandemic")$tweet.count)

print("HOUSE REPUBLICANS")
t.test(filter(ind.hist.data, chamberparty=="House Republicans", label=="Prepandemic")$tweet.count, filter(ind.hist.data, chamberparty=="House Republicans", label=="Pandemic")$tweet.count)

print("Senate REPUBLICANS")
t.test(filter(ind.hist.data, chamberparty=="Senate Republicans", label=="Prepandemic")$tweet.count, filter(ind.hist.data, chamberparty=="Senate Republicans", label=="Pandemic")$tweet.count)
```

Weekly COVID tweets and deaths UNLAGGED
```{r}
temp_top <- weekly.covid.tweets %>% 
  filter(label %in% c("All", "House", "Senate")) %>% 
  mutate(plot_label = "top")

temp_middle <- weekly.covid.tweets %>% 
  filter(label %in% c("House Democrats", "House Republicans")) %>% 
  mutate(plot_label = "middle")

temp_bottom <- weekly.covid.tweets %>% 
  filter(label %in% c("Senate Democrats", "Senate Republicans")) %>% 
  mutate(plot_label = "bottom")

temp_forplot2 <- rbind(temp_top, temp_middle, temp_bottom) %>% drop_na() %>% 
  mutate(tweet.count.per.capita = case_when(
    label=="All" ~ tweet.count/530, # 5 vacancies as over Nov. 3 2020
    label=="House" ~ tweet.count/430,
    label=="Senate" ~ tweet.count/100,
    label=="House Democrats" ~ tweet.count/232,
    label=="House Republicans" ~ tweet.count/197,
    label=="Senate Democrats" ~ tweet.count/47,
    label=="Senate Republicans" ~ tweet.count/53)) 

rm(temp_top, temp_middle, temp_bottom)
```
```{r}
coeff <- 4

ggplot(temp_forplot2,
       aes(x=enddate, color=factor(label), shape=factor(label))) +
  #geom_line(aes(y=rollmean(tweet.count, 7, na.pad =T)), size=0.45, color="black") +
  #geom_line(aes(y=rollmean(natl.week.inc.deaths / coeff, 7, na.pad =T)), size=0.45, color="tomato4")
  #geom_smooth(aes(y=tweet.count), method = "loess", se=F, span=0.1, size = 0.75, color="black") +
  geom_point(aes(y=tweet.count), size=1.4, alpha=0.8) +
  geom_line(aes(y=tweet.count), size=0.3, alpha=0.5) +
  #geom_smooth(aes(y=natl.week.inc.deaths/coeff), method = "loess", se=F, span=0.1, size = 0.75, color="tomato4") +
  geom_point(aes(y=natl.week.inc.deaths/coeff), size=1, alpha=0.8, shape=8, color="green4") +
  geom_line(aes(y=natl.week.inc.deaths/coeff), size=0.3, alpha=0.5, linetype="dotted", color="green4") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               #" "=1,
                                               "Incremental COVID deaths"=8,
                                               "Senate"=15,                                             
                                               "House"=17,
                                               "Senate Democrats"=15,
                                               "House Democrats"=17,
                                               "Senate Republicans"=15,
                                               "House Republicans"=17),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               #" "="white",
                                               "Incremental COVID deaths"="green4",
                                               "Senate"="purple4",
                                               "House"="orange3",
                                               "Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",                              
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_y_continuous(
    name = "COVID Tweet Count",
    sec.axis = sec_axis(~.*coeff, name="Incremental Deaths")
  ) +
  facet_wrap(~factor(plot_label, levels=c("top", "middle", "bottom")), nrow=3, scales="free_y") +
  theme_light() +
  theme(axis.title.x=element_blank(),
        axis.title.y = element_text(size = 7,
                                    margin = margin(r = 10)),
        axis.text.y=element_text(size=8),
        #axis.text.x=element_blank(),
        #axis.ticks.x=element_blank(),
        axis.line.y.right = element_line(color = "green4"), 
        axis.text.y.right = element_text(color = "green4"),
        axis.title.y.right = element_text(size=10,color = "green4"),
        axis.ticks.y.right = element_line(color = "green4"),
        axis.line.y.left = element_line(color = "black"), 
        axis.text.y.left = element_text(color = "black"),
        axis.title.y.left = element_text(size=10, color = "black"),
        axis.ticks.y.left = element_line(color = "black"),
        axis.text.x=element_text(size=10, angle=0, vjust=0.5),
        legend.position=c(.45,1.08),
        legend.title=element_blank(),
        legend.background=element_blank(),
        legend.direction="horizontal",
        legend.box.margin = margin(0,0,0,0),
        legend.text=element_text(size=9),
        strip.background = element_blank(),
        strip.text.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        plot.margin=unit(c(1.2,0.1,0.1,0), "cm")) +
        guides(color=guide_legend(nrow=2, byrow=F),
               shape=guide_legend(nrow=2, byrow=F)) +
  scale_x_date(date_breaks="1 month", date_labels="%b")



coeff <- 750

ggplot(temp_forplot2,
       aes(x=enddate, color=factor(label), shape=factor(label))) +
  #geom_line(aes(y=rollmean(tweet.count, 7, na.pad =T)), size=0.45, color="black") +
  #geom_line(aes(y=rollmean(natl.week.inc.deaths / coeff, 7, na.pad =T)), size=0.45, color="tomato4")
  #geom_smooth(aes(y=tweet.count), method = "loess", se=F, span=0.1, size = 0.75, color="black") +
  geom_point(aes(y=tweet.count.per.capita), size=1.4, alpha=0.8) +
  geom_line(aes(y=tweet.count.per.capita), size=0.3, alpha=0.5) +
  #geom_smooth(aes(y=natl.week.inc.deaths/coeff), method = "loess", se=F, span=0.1, size = 0.75, color="tomato4") +
  geom_point(aes(y=natl.week.inc.deaths/coeff), size=1, alpha=0.8, shape=8, color="green4") +
  geom_line(aes(y=natl.week.inc.deaths/coeff), size=0.3, alpha=0.5, linetype="dotted", color="green4") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               #" "=1,
                                               "Incremental COVID deaths"=8,
                                               "Senate"=15,                                             
                                               "House"=17,
                                               "Senate Democrats"=15,
                                               "House Democrats"=17,
                                               "Senate Republicans"=15,
                                               "House Republicans"=17),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               #" "="white",
                                               "Incremental COVID deaths"="green4",
                                               "Senate"="purple4",
                                               "House"="orange3",
                                               "Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",                              
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_y_continuous(
    name = "COVID tweets per member",
    sec.axis = sec_axis(~.*coeff, name="Incremental Deaths")
  ) +
  facet_wrap(~factor(plot_label, levels=c("top", "middle", "bottom")), nrow=3) +
  theme_light() +
  theme(axis.title.x=element_blank(),
        axis.title.y = element_text(size = 7,
                                    margin = margin(r = 10)),
        axis.text.y=element_text(size=8),
        #axis.text.x=element_blank(),
        #axis.ticks.x=element_blank(),
        axis.line.y.right = element_line(color = "green4"), 
        axis.text.y.right = element_text(color = "green4"),
        axis.title.y.right = element_text(size=10,color = "green4"),
        axis.ticks.y.right = element_line(color = "green4"),
        axis.line.y.left = element_line(color = "black"), 
        axis.text.y.left = element_text(color = "black"),
        axis.title.y.left = element_text(size=10,color = "black"),
        axis.ticks.y.left = element_line(color = "black"),
        axis.text.x=element_text(size=10, angle=0, vjust=0.5),
        legend.position="none", #c(.45,1.08),
        legend.title=element_blank(),
        legend.background=element_blank(),
        legend.direction="horizontal",
        legend.box.margin = margin(0,0,0,0),
        legend.text=element_text(size=9),
        strip.background = element_blank(),
        strip.text.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        plot.margin=unit(c(1.2,0.1,0.1,0), "cm")) +
        guides(color=guide_legend(nrow=2, byrow=F),
               shape=guide_legend(nrow=2, byrow=F)) +
  scale_x_date(date_breaks="1 month", date_labels="%b")
```

Tweet count and count per capita by dictionary group

Data prep
```{r}
temp1 <- weekly.covid.tweets.ind %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="All") %>% drop_na()


temp2 <- weekly.covid.tweets.ind %>%
  filter(chamber=="House") %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="House") %>% drop_na()

temp3 <- weekly.covid.tweets.ind %>%
  filter(chamber=="House", party.code==100) %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="House Democrats") %>% drop_na()


temp4 <- weekly.covid.tweets.ind %>%
  filter(chamber=="House", party.code==200) %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="House Republicans") %>% drop_na()


temp5 <- weekly.covid.tweets.ind %>%
  filter(chamber=="Senate") %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="Senate") %>% drop_na()

temp6 <- weekly.covid.tweets.ind %>%
  filter(chamber=="Senate", party.code==100) %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="Senate Democrats") %>% drop_na()


temp7 <- weekly.covid.tweets.ind %>%
  filter(chamber=="Senate", party.code==200) %>% 
  group_by(week) %>%
  summarize(
      #covid.tweet.count=sum(covid.tweet.count),
      #total.tweet.count=sum(total.tweet.count),
      group1.tweet.count=sum(group1.tweet.count),
      group2.tweet.count=sum(group2.tweet.count),
      group3.tweet.count=sum(group3.tweet.count),
      group4.tweet.count=sum(group4.tweet.count),
      group5.tweet.count=sum(group5.tweet.count),
      #group5_0.tweet.count=sum(group5_0.tweet.count),
      group6.tweet.count=sum(group6.tweet.count),
      group7.tweet.count=sum(group7.tweet.count),
      group8.tweet.count=sum(group8.tweet.count),
      group9.tweet.count=sum(group9.tweet.count),
      week.start=week.start) %>% distinct() %>% 
  pivot_longer(2:10, names_to = "count.label") %>% 
  mutate("label"="Senate Republicans") %>% drop_na()

temp_forplot3 <- rbind(temp1, temp2, temp3, temp4, temp5, temp6, temp7) %>%
    mutate(
      value.per.capita = case_when(
        label=="All" ~ value/530, # 5 vacancies as over Nov. 3 2020
        label=="House" ~ value/430,
        label=="Senate" ~ value/100,
        label=="House Democrats" ~ value/232,
        label=="House Republicans" ~ value/197,
        label=="Senate Democrats" ~ value/47,
        label=="Senate Republicans" ~ value/53),
      plot.label = case_when(
        label %in% c("All", "House", "Senate") ~ "top",
        label %in% c("House Democrats", "House Republicans") ~ "middle",
        label %in% c("Senate Democrats", "Senate Republicans") ~ "bottom")
    )

rm(temp1, temp2, temp3, temp4, temp5, temp6, temp7)
```

Tweet count by group
```{r}
ggplot(data=temp_forplot3 %>% filter(plot.label=="top"), aes(x=week.start, y=value, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               #" "=1,
                                               "Senate"=15,                                             
                                               "House"=17
                                               #"Senate Democrats"=15,
                                               #"House Democrats"=17,
                                               #"Senate Republicans"=15,
                                               #"House Republicans"=17
                                               ),
                     labels=c("All",
                              #" ",
                              "Senate",                                             
                              "House"
                              #"Senate Democrats",
                              #"House Democrats",
                              #"Senate Republicans",
                              #"House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               #" "="white",
                                               "Senate"="purple4",
                                               "House"="orange3"
                                               #"Senate Democrats"="navyblue",
                                               #"House Democrats"="dodgerblue",
                                               #"Senate Republicans"="darkred",
                                               #"House Republicans"="coral2"
                                               ),
                     labels=c("All",
                              #" ",
                              "Senate",                                             
                              "House"
                              #"Senate Democrats",
                              #"House Democrats",
                              #"Senate Republicans",
                              #"House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(count.label), scales="free_y", labeller = as_labeller(
    c(
      "group1.tweet.count"="Group 1: Direct Mentions",
      "group2.tweet.count"="Group 2: China",
      "group3.tweet.count"="Group 3: Behavioral Changes",
      "group4.tweet.count"="Group 4: Official Response",
      "group5.tweet.count"="Group 5: Epidemiological Language",
      "group6.tweet.count"="Group 6: Economic Impacts",
      "group7.tweet.count"="Group 7: Relief Packages",
      "group8.tweet.count"="Group 8: National Unity",
      "group9.tweet.count"="Group 9: Schooling and Evictions"
    ))) +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=90, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.1),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    legend.key.size=unit(.75, "cm"),
    strip.background = element_blank(),
    strip.text.x = element_text(color="black", size=9),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    #plot.margin=unit(c(0,0.1,0,0), "cm")
  )

ggplot(data=temp_forplot3 %>% filter(plot.label=="middle"), aes(x=week.start, y=value, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c(#"All"=19,
                                               #" "=1,
                                               #"Senate"=15,                                             
                                               #"House"=17
                                               #"Senate Democrats"=15,
                                               "House Democrats"=17,
                                               #"Senate Republicans"=15,
                                               "House Republicans"=17
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              #"Senate Democrats",
                              "House Democrats",
                              #"Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c(#"All"="black",
                                               #" "="white",
                                               #"Senate"="purple4",
                                               #"House"="orange3"
                                               #"Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               #"Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              #"Senate Democrats",
                              "House Democrats",
                              #"Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(count.label), scales="free_y", labeller = as_labeller(
    c(
      "group1.tweet.count"="Group 1: Direct Mentions",
      "group2.tweet.count"="Group 2: China",
      "group3.tweet.count"="Group 3: Behavioral Changes",
      "group4.tweet.count"="Group 4: Official Response",
      "group5.tweet.count"="Group 5: Epidemiological Language",
      "group6.tweet.count"="Group 6: Economic Impacts",
      "group7.tweet.count"="Group 7: Relief Packages",
      "group8.tweet.count"="Group 8: National Unity",
      "group9.tweet.count"="Group 9: Schooling and Evictions"
    ))) +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=90, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.1),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    legend.key.size=unit(.75, "cm"),
    strip.background = element_blank(),
    strip.text.x = element_text(color="black", size=9),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    #plot.margin=unit(c(0,0.1,0,0), "cm")
  )

ggplot(data=temp_forplot3 %>% filter(plot.label=="bottom"), aes(x=week.start, y=value, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c(#"All"=19,
                                               #" "=1,
                                               #"Senate"=15,                                             
                                               #"House"=17
                                               "Senate Democrats"=15,
                                               #"House Democrats"=17,
                                               "Senate Republicans"=15
                                               #"House Republicans"=17
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              #"Senate Democrats",
                              #"House Democrats",
                              #"Senate Republicans",
                              #"House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c(#"All"="black",
                                               #" "="white",
                                               #"Senate"="purple4",
                                               #"House"="orange3"
                                               "Senate Democrats"="navyblue",
                                               #"House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred"
                                               #"House Republicans"="coral2"
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              "Senate Democrats",
                              #"House Democrats",
                              "Senate Republicans"
                              #"House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(count.label), scales="free_y", labeller = as_labeller(
    c(
      "group1.tweet.count"="Group 1: Direct Mentions",
      "group2.tweet.count"="Group 2: China",
      "group3.tweet.count"="Group 3: Behavioral Changes",
      "group4.tweet.count"="Group 4: Official Response",
      "group5.tweet.count"="Group 5: Epidemiological Language",
      "group6.tweet.count"="Group 6: Economic Impacts",
      "group7.tweet.count"="Group 7: Relief Packages",
      "group8.tweet.count"="Group 8: National Unity",
      "group9.tweet.count"="Group 9: Schooling and Evictions"
    ))) +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=90, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.2),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    legend.key.size=unit(.75, "cm"),
    strip.background = element_blank(),
    strip.text.x = element_text(color="black", size=9),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    #plot.margin=unit(c(0,0.1,0,0), "cm")
  )
```

Tweet count per capita by group
```{r}
ggplot(data=temp_forplot3 %>% filter(plot.label=="top"), aes(x=week.start, y=value.per.capita, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               #" "=1,
                                               "Senate"=15,                                             
                                               "House"=17
                                               #"Senate Democrats"=15,
                                               #"House Democrats"=17,
                                               #"Senate Republicans"=15,
                                               #"House Republicans"=17
                                               ),
                     labels=c("All",
                              #" ",
                              "Senate",                                             
                              "House"
                              #"Senate Democrats",
                              #"House Democrats",
                              #"Senate Republicans",
                              #"House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               #" "="white",
                                               "Senate"="purple4",
                                               "House"="orange3"
                                               #"Senate Democrats"="navyblue",
                                               #"House Democrats"="dodgerblue",
                                               #"Senate Republicans"="darkred",
                                               #"House Republicans"="coral2"
                                               ),
                     labels=c("All",
                              #" ",
                              "Senate",                                             
                              "House"
                              #"Senate Democrats",
                              #"House Democrats",
                              #"Senate Republicans",
                              #"House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(count.label), scales="free_y", labeller = as_labeller(
    c(
      "group1.tweet.count"="Group 1: Direct Mentions",
      "group2.tweet.count"="Group 2: China",
      "group3.tweet.count"="Group 3: Behavioral Changes",
      "group4.tweet.count"="Group 4: Official Response",
      "group5.tweet.count"="Group 5: Epidemiological Language",
      "group6.tweet.count"="Group 6: Economic Impacts",
      "group7.tweet.count"="Group 7: Relief Packages",
      "group8.tweet.count"="Group 8: National Unity",
      "group9.tweet.count"="Group 9: Schooling and Evictions"
    ))) +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=90, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.1),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    legend.key.size=unit(.75, "cm"),
    strip.background = element_blank(),
    strip.text.x = element_text(color="black", size=9),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    #plot.margin=unit(c(0,0.1,0,0), "cm")
  )

ggplot(data=temp_forplot3 %>% filter(plot.label=="middle"), aes(x=week.start, y=value.per.capita, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c(#"All"=19,
                                               #" "=1,
                                               #"Senate"=15,                                             
                                               #"House"=17
                                               #"Senate Democrats"=15,
                                               "House Democrats"=17,
                                               #"Senate Republicans"=15,
                                               "House Republicans"=17
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              #"Senate Democrats",
                              "House Democrats",
                              #"Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c(#"All"="black",
                                               #" "="white",
                                               #"Senate"="purple4",
                                               #"House"="orange3"
                                               #"Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               #"Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              #"Senate Democrats",
                              "House Democrats",
                              #"Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(count.label), scales="free_y", labeller = as_labeller(
    c(
      "group1.tweet.count"="Group 1: Direct Mentions",
      "group2.tweet.count"="Group 2: China",
      "group3.tweet.count"="Group 3: Behavioral Changes",
      "group4.tweet.count"="Group 4: Official Response",
      "group5.tweet.count"="Group 5: Epidemiological Language",
      "group6.tweet.count"="Group 6: Economic Impacts",
      "group7.tweet.count"="Group 7: Relief Packages",
      "group8.tweet.count"="Group 8: National Unity",
      "group9.tweet.count"="Group 9: Schooling and Evictions"
    ))) +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=90, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.1),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    legend.key.size=unit(.75, "cm"),
    strip.background = element_blank(),
    strip.text.x = element_text(color="black", size=9),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    #plot.margin=unit(c(0,0.1,0,0), "cm")
  )

ggplot(data=temp_forplot3 %>% filter(plot.label=="bottom"), aes(x=week.start, y=value.per.capita, 
                              color=factor(label), 
                              shape=factor(label))) +
  geom_line(size=0.52, alpha=0.75) +
  geom_point(size=0.8) +
  scale_x_date(date_breaks="1 month", date_labels="%b") +
  scale_shape_manual(name="legend", values = c(#"All"=19,
                                               #" "=1,
                                               #"Senate"=15,                                             
                                               #"House"=17
                                               "Senate Democrats"=15,
                                               #"House Democrats"=17,
                                               "Senate Republicans"=15
                                               #"House Republicans"=17
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              #"Senate Democrats",
                              #"House Democrats",
                              #"Senate Republicans",
                              #"House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c(#"All"="black",
                                               #" "="white",
                                               #"Senate"="purple4",
                                               #"House"="orange3"
                                               "Senate Democrats"="navyblue",
                                               #"House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred"
                                               #"House Republicans"="coral2"
                                               ),
                     labels=c(#"All",
                              #" ",
                              #"Senate",                                             
                              #"House"
                              "Senate Democrats",
                              #"House Democrats",
                              "Senate Republicans"
                              #"House Republicans"
                             ),drop=F) +
  labs(x="", y="Tweets per member", title="") +
  facet_wrap(~factor(count.label), scales="free_y", labeller = as_labeller(
    c(
      "group1.tweet.count"="Group 1: Direct Mentions",
      "group2.tweet.count"="Group 2: China",
      "group3.tweet.count"="Group 3: Behavioral Changes",
      "group4.tweet.count"="Group 4: Official Response",
      "group5.tweet.count"="Group 5: Epidemiological Language",
      "group6.tweet.count"="Group 6: Economic Impacts",
      "group7.tweet.count"="Group 7: Relief Packages",
      "group8.tweet.count"="Group 8: National Unity",
      "group9.tweet.count"="Group 9: Schooling and Evictions"
    ))) +
  theme_light() +
  theme(
    axis.text.x=element_text(size=9, angle=90, vjust=0.5),
    axis.title.y=element_text(size=10),
    legend.position=c(.45,1.2),
    legend.title=element_blank(),
    legend.background=element_blank(),
    legend.direction="horizontal",
    legend.box.margin = margin(0,0,0,0),
    legend.text=element_text(size=10),
    legend.key.size=unit(.75, "cm"),
    strip.background = element_blank(),
    strip.text.x = element_text(color="black", size=9),
    panel.grid.minor.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    panel.grid.major.y = element_blank(),
    #plot.margin=unit(c(0,0.1,0,0), "cm")
  )
```

Group 5 tweet count with natl deaths
```{r}
temp_forplot4 <- weekly.covid.tweets.ind %>% 
  group_by(week, chamber, party.code) %>% 
  summarize(group5.tweet.count=sum(group5.tweet.count)) %>% 
  mutate(party=recode(party.code, `100`="Democrats", `200`="Republicans", `328`="Other")) %>% 
  select(-party.code) %>% drop_na() %>% 
  mutate(label=paste(chamber, party)) %>%
  ungroup() %>% select(-party, -chamber) %>% 
  rbind(
    weekly.covid.tweets.ind %>% group_by(chamber, week) %>% 
      summarize(group5.tweet.count=sum(group5.tweet.count),
                label=chamber) %>% distinct() %>% ungroup() %>% 
      drop_na() %>% select(-chamber)
  ) %>% 
  left_join(temp_forplot2 %>% 
              select(enddate, weekly_index, natl.week.inc.deaths) 
            %>% distinct(), by=c("week"="weekly_index")) %>% 
  distinct()

temp_forplot4 <- temp_forplot4 %>% filter(!(label %in% c("House", "Senate"))) %>% 
  group_by(week) %>% 
  summarize(group5.tweet.count=sum(group5.tweet.count),
            label="All", enddate=enddate, 
            natl.week.inc.deaths=natl.week.inc.deaths) %>% 
  distinct() %>% 
  rbind(temp_forplot4) %>% arrange(week) %>% drop_na() %>%
  filter(!grepl("Other",label)) %>% 
  mutate(group5.tweet.count.per.capita = case_when(
    label=="All" ~ group5.tweet.count/530, # 5 vacancies as over Nov. 3 2020
    label=="House" ~ group5.tweet.count/430,
    label=="Senate" ~ group5.tweet.count/100,
    label=="House Democrats" ~ group5.tweet.count/232,
    label=="House Republicans" ~ group5.tweet.count/197,
    label=="Senate Democrats" ~ group5.tweet.count/47,
    label=="Senate Republicans" ~ group5.tweet.count/53)) %>% 
  mutate(plot.label = case_when(
    label %in% c("All", "House", "Senate") ~ "top",
    label %in% c("House Democrats", "House Republicans") ~ "middle",
    label %in% c("Senate Democrats", "Senate Republicans") ~ "bottom"))
    


```
```{r}
coeff <- 20

ggplot(temp_forplot4,
       aes(x=enddate, color=factor(label), shape=factor(label))) +
  #geom_line(aes(y=rollmean(group5.tweet.count, 7, na.pad =T)), size=0.45, color="black") +
  #geom_line(aes(y=rollmean(natl.week.inc.deaths / coeff, 7, na.pad =T)), size=0.45, color="tomato4")
  #geom_smooth(aes(y=group5.tweet.count), method = "loess", se=F, span=0.1, size = 0.75, color="black") +
  geom_point(aes(y=group5.tweet.count), size=1.4, alpha=0.8) +
  geom_line(aes(y=group5.tweet.count), size=0.3, alpha=0.5) +
  #geom_smooth(aes(y=natl.week.inc.deaths/coeff), method = "loess", se=F, span=0.1, size = 0.75, color="tomato4") +
  geom_point(aes(y=natl.week.inc.deaths/coeff), size=1, alpha=0.8, shape=8, color="green4") +
  geom_line(aes(y=natl.week.inc.deaths/coeff), size=0.3, alpha=0.5, linetype="dotted", color="green4") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               #" "=1,
                                               "Incremental COVID deaths"=8,
                                               "Senate"=15,                                             
                                               "House"=17,
                                               "Senate Democrats"=15,
                                               "House Democrats"=17,
                                               "Senate Republicans"=15,
                                               "House Republicans"=17),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               #" "="white",
                                               "Incremental COVID deaths"="green4",
                                               "Senate"="purple4",
                                               "House"="orange3",
                                               "Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",                              
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_y_continuous(
    name = "COVID Tweet Count",
    sec.axis = sec_axis(~.*coeff, name="Incremental Deaths")
  ) +
  facet_wrap(~factor(plot.label, levels=c("top", "middle", "bottom")), nrow=3, scales="free_y") +
  theme_light() +
  theme(axis.title.x=element_blank(),
        axis.title.y = element_text(size = 7,
                                    margin = margin(r = 10)),
        axis.text.y=element_text(size=8),
        #axis.text.x=element_blank(),
        #axis.ticks.x=element_blank(),
        axis.line.y.right = element_line(color = "green4"), 
        axis.text.y.right = element_text(color = "green4"),
        axis.title.y.right = element_text(size=10,color = "green4"),
        axis.ticks.y.right = element_line(color = "green4"),
        axis.line.y.left = element_line(color = "black"), 
        axis.text.y.left = element_text(color = "black"),
        axis.title.y.left = element_text(size=10, color = "black"),
        axis.ticks.y.left = element_line(color = "black"),
        axis.text.x=element_text(size=10, angle=0, vjust=0.5),
        legend.position=c(.45,1.08),
        legend.title=element_blank(),
        legend.background=element_blank(),
        legend.direction="horizontal",
        legend.box.margin = margin(0,0,0,0),
        legend.text=element_text(size=9),
        strip.background = element_blank(),
        strip.text.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        plot.margin=unit(c(1.2,0.1,0.1,0), "cm")) +
        guides(color=guide_legend(nrow=2, byrow=F),
               shape=guide_legend(nrow=2, byrow=F)) +
  scale_x_date(date_breaks="1 month", date_labels="%b")
```
```{r}
coeff <- 5000

ggplot(temp_forplot4,
       aes(x=enddate, color=factor(label), shape=factor(label))) +
  #geom_line(aes(y=rollmean(tweet.count, 7, na.pad =T)), size=0.45, color="black") +
  #geom_line(aes(y=rollmean(natl.week.inc.deaths / coeff, 7, na.pad =T)), size=0.45, color="tomato4")
  #geom_smooth(aes(y=tweet.count), method = "loess", se=F, span=0.1, size = 0.75, color="black") +
  geom_point(aes(y=group5.tweet.count.per.capita), size=1.4, alpha=0.8) +
  geom_line(aes(y=group5.tweet.count.per.capita), size=0.3, alpha=0.5) +
  #geom_smooth(aes(y=natl.week.inc.deaths/coeff), method = "loess", se=F, span=0.1, size = 0.75, color="tomato4") +
  geom_point(aes(y=natl.week.inc.deaths/coeff), size=1, alpha=0.8, shape=8, color="green4") +
  geom_line(aes(y=natl.week.inc.deaths/coeff), size=0.3, alpha=0.5, linetype="dotted", color="green4") +
  scale_shape_manual(name="legend", values = c("All"=19,
                                               #" "=1,
                                               "Incremental COVID deaths"=8,
                                               "Senate"=15,                                             
                                               "House"=17,
                                               "Senate Democrats"=15,
                                               "House Democrats"=17,
                                               "Senate Republicans"=15,
                                               "House Republicans"=17),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_color_manual(name="legend", values = c("All"="black",
                                               #" "="white",
                                               "Incremental COVID deaths"="green4",
                                               "Senate"="purple4",
                                               "House"="orange3",
                                               "Senate Democrats"="navyblue",
                                               "House Democrats"="dodgerblue",
                                               "Senate Republicans"="darkred",
                                               "House Republicans"="coral2"
                                               ),
                     labels=c("All members",
                              #" ",
                              "Incremental COVID deaths",                              
                              "Senate",                                             
                              "House",
                              "Senate Democrats",
                              "House Democrats",
                              "Senate Republicans",
                              "House Republicans"
                             ),drop=F) +
  scale_y_continuous(
    name = "COVID tweets per member",
    sec.axis = sec_axis(~.*coeff, name="Incremental Deaths")
  ) +
  facet_wrap(~factor(plot.label, levels=c("top", "middle", "bottom")), nrow=3) +
  theme_light() +
  theme(axis.title.x=element_blank(),
        axis.title.y = element_text(size = 7,
                                    margin = margin(r = 10)),
        axis.text.y=element_text(size=8),
        #axis.text.x=element_blank(),
        #axis.ticks.x=element_blank(),
        axis.line.y.right = element_line(color = "green4"), 
        axis.text.y.right = element_text(color = "green4"),
        axis.title.y.right = element_text(size=10,color = "green4"),
        axis.ticks.y.right = element_line(color = "green4"),
        axis.line.y.left = element_line(color = "black"), 
        axis.text.y.left = element_text(color = "black"),
        axis.title.y.left = element_text(size=10,color = "black"),
        axis.ticks.y.left = element_line(color = "black"),
        axis.text.x=element_text(size=10, angle=0, vjust=0.5),
        legend.position="none", #c(.45,1.08),
        legend.title=element_blank(),
        legend.background=element_blank(),
        legend.direction="horizontal",
        legend.box.margin = margin(0,0,0,0),
        legend.text=element_text(size=9),
        strip.background = element_blank(),
        strip.text.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        plot.margin=unit(c(1.2,0.1,0.1,0), "cm")) +
        guides(color=guide_legend(nrow=2, byrow=F),
               shape=guide_legend(nrow=2, byrow=F)) +
  scale_x_date(date_breaks="1 month", date_labels="%b")
```

